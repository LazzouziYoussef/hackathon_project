name: Auto Merge Dev to Main

on:
  workflow_run:
    workflows:
      - "Lint and Type Check (Dev)"
      - "Docker Build (Dev)"
    branches:
      - dev
    types:
      - completed

jobs:
  merge-to-main:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Configure Git User
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
      - name: Fetch All Branches
        run: git fetch --all
      - name: Checkout Main
        run: git checkout main
      - name: Merge Dev to Main
        run: git merge origin/dev --no-ff -m 'chore: auto-merge dev to main'
      - name: Push to Main
        run: git push origin main
